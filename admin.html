<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¹¿å‘Šç®¡ç†</title>
  <style>
    body { font-family: 'Microsoft YaHei', Arial, sans-serif; background:#0f172a; color:#e2e8f0; padding: 24px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p.note { margin: 0 0 16px; color:#94a3b8; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap:16px; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:12px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    .row { display:flex; gap:10px; }
    label { display:block; font-size:12px; color:#93c5fd; margin:6px 0 4px; }
    input[type="url"], input[type="text"] { width:100%; padding:10px; border-radius:8px; border:1px solid #374151; background:#0b1220; color:#e5e7eb; }
    .row-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }
    .row-4 { display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:10px; }
    select, input[type="color"], input[type="number"] { width:100%; padding:10px; border-radius:8px; border:1px solid #374151; background:#0b1220; color:#e5e7eb; }
    .actions { margin-top:10px; display:flex; gap:10px; }
    button { padding:10px 12px; border:none; border-radius:8px; cursor:pointer; }
    .save { background:#3b82f6; color:#fff; }
    .reset { background:#374151; color:#e5e7eb; }
    .toggle { display:flex; align-items:center; gap:8px; margin-top:10px; }
    .toggle input { transform: scale(1.2); }
    .hr { height:1px; background:#1f2937; margin:18px 0; }
    .hint { font-size:12px; color:#9ca3af; }
    .link { color:#60a5fa; text-decoration:none; }
    /* ç™»å½•é®ç½© */
    .auth-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 9999; }
    .auth-card { background:#111827; border:1px solid #1f2937; border-radius:12px; padding:20px; width: min(360px, 92vw); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .auth-card h3 { margin:0 0 12px; font-size: 18px; }
    .auth-card .row { display:flex; flex-direction:column; gap:10px; }
    .auth-card input { width:100%; padding:10px; border-radius:8px; border:1px solid #374151; background:#0b1220; color:#e5e7eb; }
    .auth-card .actions { display:flex; gap:10px; margin-top: 10px; }
  </style>
</head>
<body>
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-card">
      <h3>ç™»å½•åå°</h3>
      <div class="row">
        <div>
          <label>ç”¨æˆ·å</label>
          <input id="authUser" type="text" placeholder="gugd888" />
        </div>
        <div>
          <label>å¯†ç </label>
          <input id="authPass" type="password" placeholder="qjklwwqvb888///" />
        </div>
        <div class="actions">
          <button class="save" id="btnAuthLogin">ç™»å½•</button>
          <button class="reset" id="btnAuthReset">æ¢å¤é»˜è®¤è´¦å·</button>
        </div>
        <div class="hint">é»˜è®¤ç”¨æˆ·åï¼šgugd888ï¼Œå¯†ç ï¼šqjklwwqvb888///ã€‚å¯åœ¨ç™»å½•æˆåŠŸåå‰å¾€â€œå…¨å±€åŒæ­¥è®¾ç½®â€ä¸‹æ–¹ä¿å­˜å‡­æ®ï¼ˆä¿å­˜åœ¨æœ¬æœºï¼Œä¸ä¸Šä¼ æœåŠ¡å™¨ï¼‰ã€‚</div>
      </div>
    </div>
  </div>

  <h1>å¹¿å‘Šç®¡ç†</h1>
  <p class="note">æœ¬é¡µé¢å˜æ›´ä¼šä¿å­˜åˆ°æµè§ˆå™¨ localStorageã€‚å‰å°é¡µé¢ä¼šè‡ªåŠ¨è¯»å–ã€‚ä½ å¯ä»¥å…ˆåœ¨æ­¤ä¿å­˜ï¼Œç„¶ååœ¨å‰å°åˆ·æ–°æŸ¥çœ‹æ•ˆæœã€‚
    <a class="link" href="index.html" target="_blank" rel="noopener noreferrer">æ‰“å¼€å‰å°</a>
  </p>
  <div class="card" style="margin-bottom:16px">
    <div class="row" style="justify-content:space-between; align-items:center">
      <div>
        <b>è½®æ’­ä¸å®šæ—¶</b>
        <div class="hint">ä¸ºé¡¶éƒ¨å¹¿å‘Šå¯ç”¨å›¾ç‰‡è½®æ’­ï¼Œå¯é…ç½®é—´éš”ï¼ˆç§’ï¼‰ã€‚</div>
      </div>
      <div class="row" style="align-items:center">
        <label style="display:flex;align-items:center;gap:8px">
          <input id="topCarouselEnabled" type="checkbox" /> é¡¶éƒ¨è½®æ’­
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          é—´éš”
          <input id="topCarouselInterval" type="number" min="2" max="120" value="8" style="width:80px" /> ç§’
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          è½®æ’­å›¾ç‰‡ï¼ˆé€—å·åˆ†éš”URLï¼‰
          <input id="topCarouselImages" type="text" placeholder="https://a.jpg, https://b.jpg" style="min-width:360px" />
        </label>
        <button class="save" id="saveCarousel">ä¿å­˜è½®æ’­</button>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>é¡¶éƒ¨æ¨ªå¹…</h3>
      <div class="toggle">
        <input id="topVisible" type="checkbox" />
        <label for="topVisible">æ˜¾ç¤ºé¡¶éƒ¨å¹¿å‘Š</label>
      </div>
      <label for="topText">å¹¿å‘Šè¯ï¼ˆå¯ç•™ç©ºï¼‰</label>
      <input id="topText" type="text" placeholder="ä¾‹å¦‚ï¼šé™æ—¶æ´»åŠ¨ï¼Œç«‹å³æŸ¥çœ‹" />
      <div class="hint">å¯Œæ–‡æœ¬ç¤ºä¾‹ï¼š&lt;b style='color:#ff0'&gt;å¤§ä¿ƒ&lt;/b&gt;ï¼Œ&lt;i&gt;é™æ—¶24å°æ—¶&lt;/i&gt;ï¼Œ&lt;a href='https://example.com' style='color:#0ff' target='_blank'&gt;ç«‹å³å‰å¾€&lt;/a&gt;</div>
      <div class="row-3">
        <div>
          <label for="topTextColor">æ–‡å­—é¢œè‰²</label>
          <input id="topTextColor" type="color" value="#ffffff" />
        </div>
        <div>
          <label for="topTextSize">å­—å·(px)</label>
          <input id="topTextSize" type="number" min="10" max="36" value="16" />
        </div>
        <div>
          <label for="topTextPos">ä½ç½®</label>
          <select id="topTextPos">
            <option value="lb">å·¦ä¸‹</option>
            <option value="rb">å³ä¸‹</option>
            <option value="lt">å·¦ä¸Š</option>
            <option value="rt">å³ä¸Š</option>
            <option value="cc">å±…ä¸­</option>
          </select>
        </div>
      </div>
      <div class="row-4">
        <div>
          <label for="topBgColor">èƒŒæ™¯é¢œè‰²</label>
          <input id="topBgColor" type="color" value="#000000" />
        </div>
        <div>
          <label for="topBgOpacity">èƒŒæ™¯ä¸é€æ˜åº¦(0-100)</label>
          <input id="topBgOpacity" type="number" min="0" max="100" value="55" />
        </div>
        <div>
          <label for="topRadius">åœ†è§’(px)</label>
          <input id="topRadius" type="number" min="0" max="32" value="8" />
        </div>
        <div>
          <label for="topFontFamily">å­—ä½“å®¶æ—</label>
          <input id="topFontFamily" type="text" placeholder="å¦‚ï¼š'Microsoft YaHei', Arial" />
        </div>
      </div>
      <div class="row-3">
        <div>
          <label for="topShadow">é˜´å½±å¼ºåº¦(0~1)</label>
          <input id="topShadow" type="number" step="0.1" min="0" max="1" value="0.35" />
        </div>
        <div>
          <label for="topTextAlign">å¯¹é½</label>
          <select id="topTextAlign">
            <option value="left">å·¦</option>
            <option value="center">ä¸­</option>
            <option value="right">å³</option>
          </select>
        </div>
        <div>
          <label for="topOutline">æè¾¹(pxå’Œé¢œè‰²)</label>
          <input id="topOutlineWidth" type="number" min="0" max="4" value="0" />
          <input id="topOutlineColor" type="color" value="#000000" />
        </div>
      </div>
      <div class="row">
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="topTextBold" type="checkbox" /> åŠ ç²—
        </label>
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="topTextHtml" type="checkbox" /> ä½¿ç”¨å¯Œæ–‡æœ¬(æ”¯æŒHTML)
        </label>
      </div>
      <label for="topLink">è·³è½¬é“¾æ¥</label>
      <input id="topLink" type="url" placeholder="https://example.com" />
      <label for="topImage">å›¾ç‰‡/GIFåœ°å€</label>
      <input id="topImage" type="url" placeholder="https://.../banner.jpg æˆ– .gif" />
      <div class="actions">
        <button class="save" id="saveTop">ä¿å­˜</button>
        <button class="reset" id="resetTop">æ¢å¤é»˜è®¤</button>
      </div>
    </div>

    <div class="card">
      <h3>å·¦ä¾§å¹¿å‘Š</h3>
      <div class="toggle">
        <input id="leftVisible" type="checkbox" />
        <label for="leftVisible">æ˜¾ç¤ºå·¦ä¾§å¹¿å‘Š</label>
      </div>
      <label for="leftText">å¹¿å‘Šè¯ï¼ˆå¯ç•™ç©ºï¼‰</label>
      <input id="leftText" type="text" placeholder="ä¾‹å¦‚ï¼šæ–°å“ä¸Šæ¶" />
      <div class="hint">å¯Œæ–‡æœ¬ç¤ºä¾‹ï¼šæ”¯æŒæ¢è¡Œ&lt;br/&gt;ä¸å†…è”æ ·å¼</div>
      <div class="row-3">
        <div>
          <label for="leftTextColor">æ–‡å­—é¢œè‰²</label>
          <input id="leftTextColor" type="color" value="#ffffff" />
        </div>
        <div>
          <label for="leftTextSize">å­—å·(px)</label>
          <input id="leftTextSize" type="number" min="10" max="36" value="16" />
        </div>
        <div>
          <label for="leftTextPos">ä½ç½®</label>
          <select id="leftTextPos">
            <option value="lb">å·¦ä¸‹</option>
            <option value="rb">å³ä¸‹</option>
            <option value="lt">å·¦ä¸Š</option>
            <option value="rt">å³ä¸Š</option>
            <option value="cc">å±…ä¸­</option>
          </select>
        </div>
      </div>
      <div class="row-4">
        <div>
          <label for="leftBgColor">èƒŒæ™¯é¢œè‰²</label>
          <input id="leftBgColor" type="color" value="#000000" />
        </div>
        <div>
          <label for="leftBgOpacity">èƒŒæ™¯ä¸é€æ˜åº¦(0-100)</label>
          <input id="leftBgOpacity" type="number" min="0" max="100" value="55" />
        </div>
        <div>
          <label for="leftRadius">åœ†è§’(px)</label>
          <input id="leftRadius" type="number" min="0" max="32" value="8" />
        </div>
        <div>
          <label for="leftFontFamily">å­—ä½“å®¶æ—</label>
          <input id="leftFontFamily" type="text" placeholder="å¦‚ï¼š'Microsoft YaHei', Arial" />
        </div>
      </div>
      <div class="row-3">
        <div>
          <label for="leftShadow">é˜´å½±å¼ºåº¦(0~1)</label>
          <input id="leftShadow" type="number" step="0.1" min="0" max="1" value="0.35" />
        </div>
        <div>
          <label for="leftTextAlign">å¯¹é½</label>
          <select id="leftTextAlign">
            <option value="left">å·¦</option>
            <option value="center">ä¸­</option>
            <option value="right">å³</option>
          </select>
        </div>
        <div>
          <label for="leftOutline">æè¾¹(pxå’Œé¢œè‰²)</label>
          <input id="leftOutlineWidth" type="number" min="0" max="4" value="0" />
          <input id="leftOutlineColor" type="color" value="#000000" />
        </div>
      </div>
      <div class="row">
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="leftTextBold" type="checkbox" /> åŠ ç²—
        </label>
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="leftTextHtml" type="checkbox" /> ä½¿ç”¨å¯Œæ–‡æœ¬(æ”¯æŒHTML)
        </label>
      </div>
      <label for="leftLink">è·³è½¬é“¾æ¥</label>
      <input id="leftLink" type="url" placeholder="https://example.com" />
      <label for="leftImage">å›¾ç‰‡/GIFåœ°å€</label>
      <input id="leftImage" type="url" placeholder="https://.../image.jpg æˆ– .gif" />
      <div class="actions">
        <button class="save" id="saveLeft">ä¿å­˜</button>
        <button class="reset" id="resetLeft">æ¢å¤é»˜è®¤</button>
      </div>
    </div>

    <div class="card">
      <h3>å³ä¾§å¹¿å‘Š</h3>
      <div class="toggle">
        <input id="rightVisible" type="checkbox" />
        <label for="rightVisible">æ˜¾ç¤ºå³ä¾§å¹¿å‘Š</label>
      </div>
      <label for="rightText">å¹¿å‘Šè¯ï¼ˆå¯ç•™ç©ºï¼‰</label>
      <input id="rightText" type="text" placeholder="ä¾‹å¦‚ï¼šè¶…å€¼ä¼˜æƒ " />
      <div class="hint">å¯Œæ–‡æœ¬ç¤ºä¾‹ï¼šå¯æ”¾ç½®å›¾æ ‡ &amp; emoji âœ¨ğŸ”¥</div>
      <div class="row-3">
        <div>
          <label for="rightTextColor">æ–‡å­—é¢œè‰²</label>
          <input id="rightTextColor" type="color" value="#ffffff" />
        </div>
        <div>
          <label for="rightTextSize">å­—å·(px)</label>
          <input id="rightTextSize" type="number" min="10" max="36" value="16" />
        </div>
        <div>
          <label for="rightTextPos">ä½ç½®</label>
          <select id="rightTextPos">
            <option value="lb">å·¦ä¸‹</option>
            <option value="rb">å³ä¸‹</option>
            <option value="lt">å·¦ä¸Š</option>
            <option value="rt">å³ä¸Š</option>
            <option value="cc">å±…ä¸­</option>
          </select>
        </div>
      </div>
      <div class="row-4">
        <div>
          <label for="rightBgColor">èƒŒæ™¯é¢œè‰²</label>
          <input id="rightBgColor" type="color" value="#000000" />
        </div>
        <div>
          <label for="rightBgOpacity">èƒŒæ™¯ä¸é€æ˜åº¦(0-100)</label>
          <input id="rightBgOpacity" type="number" min="0" max="100" value="55" />
        </div>
        <div>
          <label for="rightRadius">åœ†è§’(px)</label>
          <input id="rightRadius" type="number" min="0" max="32" value="8" />
        </div>
        <div>
          <label for="rightFontFamily">å­—ä½“å®¶æ—</label>
          <input id="rightFontFamily" type="text" placeholder="å¦‚ï¼š'Microsoft YaHei', Arial" />
        </div>
      </div>
      <div class="row-3">
        <div>
          <label for="rightShadow">é˜´å½±å¼ºåº¦(0~1)</label>
          <input id="rightShadow" type="number" step="0.1" min="0" max="1" value="0.35" />
        </div>
        <div>
          <label for="rightTextAlign">å¯¹é½</label>
          <select id="rightTextAlign">
            <option value="left">å·¦</option>
            <option value="center">ä¸­</option>
            <option value="right">å³</option>
          </select>
        </div>
        <div>
          <label for="rightOutline">æè¾¹(pxå’Œé¢œè‰²)</label>
          <input id="rightOutlineWidth" type="number" min="0" max="4" value="0" />
          <input id="rightOutlineColor" type="color" value="#000000" />
        </div>
      </div>
      <div class="row">
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="rightTextBold" type="checkbox" /> åŠ ç²—
        </label>
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="rightTextHtml" type="checkbox" /> ä½¿ç”¨å¯Œæ–‡æœ¬(æ”¯æŒHTML)
        </label>
      </div>
      <label for="rightLink">è·³è½¬é“¾æ¥</label>
      <input id="rightLink" type="url" placeholder="https://example.com" />
      <label for="rightImage">å›¾ç‰‡/GIFåœ°å€</label>
      <input id="rightImage" type="url" placeholder="https://.../image.jpg æˆ– .gif" />
      <div class="actions">
        <button class="save" id="saveRight">ä¿å­˜</button>
        <button class="reset" id="resetRight">æ¢å¤é»˜è®¤</button>
      </div>
    </div>
  </div>

  <div class="hr"></div>
  <p class="hint">æç¤ºï¼šå‰å°ä¼šè¯»å–é”® adConfigã€leftAdConfigã€rightAdConfigã€adCarousel ä»¥åŠ adVisibilityã€‚è‹¥å¹¿å‘Šè¢«å…³é—­ï¼Œå‰å°å°†éšè—å¯¹åº”åŒºåŸŸã€‚</p>

  <div class="card" style="margin-top:16px">
    <h3>è·¨è®¾å¤‡å¹¿å‘Šé…ç½®åŒæ­¥</h3>
    <div class="hint" style="margin-bottom:8px">è¯´æ˜ï¼šå°†å½“å‰æµè§ˆå™¨é‡Œçš„å¹¿å‘Šé…ç½®å¯¼å‡ºä¸º <code>ad_config.json</code>ï¼Œæ”¾åˆ°ç½‘ç«™æ ¹ç›®å½•ï¼ˆä¸ index.html åŒçº§ï¼‰åï¼Œå‰å°ä¼šåœ¨åŠ è½½æ—¶è¯»å–ï¼Œä»è€Œè®©ç§»åŠ¨ç«¯ä¸ç”µè„‘ç«¯ä¿æŒä¸€è‡´ã€‚</div>
    <div class="row" style="align-items:center; gap:12px">
      <button class="save" id="btnDownloadConfig">ä¸‹è½½ ad_config.json</button>
      <span class="hint">æˆ–æ¨é€åˆ° GitHubï¼ˆä¸‹æ–¹å‡­æ®å¤ç”¨ï¼‰</span>
    </div>
    <div class="grid" style="grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:10px; margin-top:8px">
      <div>
        <label for="cfgPath">é…ç½®æ–‡ä»¶è·¯å¾„</label>
        <input id="cfgPath" type="text" value="ad_config.json" />
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="save" id="btnPushConfig">æ¨é€ ad_config.json åˆ° GitHub</button>
      <span class="hint" id="cfgPushStatus"></span>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>å…¨å±€åŒæ­¥è®¾ç½®</h3>
    <div class="hint" style="margin-bottom:8px">å‹¾é€‰åï¼šæ¯æ¬¡ç‚¹å‡»ä¿å­˜å¹¿å‘Šé…ç½®/å¯è§æ€§/è½®æ’­å°†è‡ªåŠ¨æ¨é€ <code>ad_config.json</code>ï¼›çˆ¬å–å®Œæˆæˆ–å®šæ—¶ä»»åŠ¡ç»“æŸåå°†è‡ªåŠ¨æ¨é€æœ€æ–° CSVã€‚éœ€è¦å…ˆåœ¨ä¸‹æ–¹å¡«å†™ GitHub å‡­æ®ã€‚</div>
    <div class="row" style="align-items:center; gap:12px">
      <label style="display:flex; align-items:center; gap:8px">
        <input id="autoSyncAd" type="checkbox" /> ä¿å­˜åè‡ªåŠ¨åŒæ­¥å¹¿å‘Šé…ç½®
      </label>
      <label style="display:flex; align-items:center; gap:8px">
        <input id="autoSyncCsv" type="checkbox" /> çˆ¬å–åè‡ªåŠ¨æ¨é€ CSV
      </label>
      <button class="save" id="btnSaveSync">ä¿å­˜è®¾ç½®</button>
      <span class="hint" id="syncStatus"></span>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>ä¸€é”®çˆ¬å– / è‡ªåŠ¨æ›´æ–°ï¼ˆçº¯å‰ç«¯ï¼‰</h3>
    <div class="hint" style="margin-bottom:8px">è¯´æ˜ï¼šæœ¬åŠŸèƒ½åœ¨æµè§ˆå™¨ä¸­æ‰§è¡ŒæŠ“å–ï¼Œå—ç›®æ ‡ç«™ CORS é™åˆ¶ï¼Œå»ºè®®é…ç½® CORS ä»£ç†ã€‚æŠ“å–å®Œæˆä¼šç”Ÿæˆæœ€æ–°çš„ video_data.csv å¹¶å¯é€‰æ¨é€åˆ° GitHub ä»“åº“è¦†ç›–ç«™ç‚¹ã€‚</div>

    <label>ç›®æ ‡åˆ—è¡¨é¡µèµ·å§‹URLï¼ˆå¯å¤šæ¡ï¼Œé€—å·åˆ†éš”ï¼‰</label>
    <input id="crawlSites" type="text" placeholder="https://senlinzy.com/index.php/index/index/page/1.html, https://xxx.com/page/1" />

    <div class="row-3" style="margin-top:8px">
      <div>
        <label for="crawlPages">æœ€å¤§é¡µæ•°</label>
        <input id="crawlPages" type="number" min="1" max="50" value="5" />
      </div>
      <div>
        <label for="crawlSleep">è¯¦æƒ…é¡µé—´éš”(ç§’)</label>
        <input id="crawlSleep" type="number" min="0" step="0.2" value="1.0" />
      </div>
      <div>
        <label for="crawlProxy">CORSä»£ç†ï¼ˆç•™ç©ºç›´è¿ï¼‰</label>
        <input id="crawlProxy" type="text" placeholder="https://api.allorigins.win/raw?url=%s" />
      </div>
    </div>

    <div class="row" style="margin-top:8px; align-items:center">
      <button class="save" id="btnCrawlNow">ç«‹å³çˆ¬å–å¹¶ç”ŸæˆCSV</button>
      <button class="reset" id="btnDownloadCsv">ä¸‹è½½CSV</button>
      <span class="hint" id="crawlStatus" style="margin-left:8px"></span>
    </div>

    <div class="hr"></div>
    <h4>æ¨é€åˆ° GitHubï¼ˆå¯é€‰ï¼‰</h4>
    <div class="grid" style="grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:10px">
      <div>
        <label for="ghOwner">Owner/Org</label>
        <input id="ghOwner" type="text" placeholder="yourname" />
      </div>
      <div>
        <label for="ghRepo">Repo</label>
        <input id="ghRepo" type="text" placeholder="yourrepo" />
      </div>
      <div>
        <label for="ghBranch">Branch</label>
        <input id="ghBranch" type="text" value="main" />
      </div>
      <div>
        <label for="ghPath">æ–‡ä»¶è·¯å¾„</label>
        <input id="ghPath" type="text" value="video_data.csv" />
      </div>
      <div>
        <label for="ghToken">Tokenï¼ˆrepo æƒé™ï¼‰</label>
        <input id="ghToken" type="text" placeholder="ghp_..." />
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="save" id="btnPushGithub">æ¨é€åˆ° GitHub</button>
    </div>

    <div class="hr"></div>
    <h4>å®šæ—¶è‡ªåŠ¨æ›´æ–°ï¼ˆä»…åœ¨æœ¬é¡µæ‰“å¼€æ—¶æœ‰æ•ˆï¼‰</h4>
    <div class="row" style="align-items:center; gap:12px">
      <label style="display:flex;align-items:center;gap:8px">
        <input id="autoEnabled" type="checkbox" /> å¼€å¯å®šæ—¶
      </label>
      <label style="display:flex;align-items:center;gap:8px">
        é—´éš”(åˆ†é’Ÿ)
        <input id="autoInterval" type="number" min="1" value="60" style="width:100px" />
      </label>
      <button class="save" id="btnSaveAuto">ä¿å­˜å®šæ—¶</button>
      <span class="hint" id="autoStatus"></span>
    </div>
  </div>

  <script>
    // ===== ç®€å•æœ¬åœ°ç™»å½•ï¼ˆå­˜äºæœ¬æœºï¼ŒéæœåŠ¡ç«¯éªŒè¯ï¼‰=====
    function loadAuth(){ try { return JSON.parse(localStorage.getItem('adminAuth')||'null')||{ user:'gugd888', pass:'qjklwwqvb888///' } } catch { return { user:'gugd888', pass:'qjklwwqvb888///' } } }
    function saveAuth(a){ try { localStorage.setItem('adminAuth', JSON.stringify(a)); } catch{} }
    function requireAuth(){
      const auth = loadAuth();
      const ok = sessionStorage.getItem('adminAuthed') === '1';
      const overlay = document.getElementById('authOverlay');
      if (!ok){ overlay.style.display = 'flex'; }
      document.getElementById('authUser').value = auth.user||'gugd888';
      document.getElementById('authPass').value = '';
      document.getElementById('btnAuthLogin').onclick = () => {
        const u = (document.getElementById('authUser')||{}).value || '';
        const p = (document.getElementById('authPass')||{}).value || '';
        if (u === (auth.user||'gugd888') && p === (auth.pass||'qjklwwqvb888///')){
          sessionStorage.setItem('adminAuthed', '1');
          overlay.style.display = 'none';
        } else {
          alert('ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®');
        }
      };
      document.getElementById('btnAuthReset').onclick = () => {
        saveAuth({ user:'gugd888', pass:'qjklwwqvb888///' });
        alert('å·²æ¢å¤é»˜è®¤ï¼šgugd888 / qjklwwqvb888///');
        document.getElementById('authUser').value = 'gugd888';
        document.getElementById('authPass').value = '';
      };
    }

    const DEFAULT_AD = { link: 'https://example.com', image: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop', text: '', textColor: '#ffffff', textSize: 16, textPos: 'lb', textBold: false, bgOpacity: 55, radius: 8, shadow: true };
    const DEFAULT_SIDE_AD = { link: 'https://example.com', image: 'https://images.unsplash.com/photo-1520975922424-c2e8e3f84b68?q=80&w=900&auto=format&fit=crop', text: '', textColor: '#ffffff', textSize: 16, textPos: 'lb', textBold: false, bgOpacity: 55, radius: 8, shadow: true };

    function getJSON(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key) || 'null') || fallback; } catch { return fallback; }
    }
    function setJSON(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

    const DEFAULT_START_URL = 'https://senlinzy.com/index.php/index/index/page/1.html';
    const DEFAULT_CORS_PROXY = 'https://api.allorigins.win/raw?url=%s';

    function coalesce(val, fallback) { return (val === undefined || val === null) ? fallback : val; }
    function init() {
      // è½®æ’­è®¾ç½®
      const carousel = getJSON('adCarousel', { enabled:false, interval:8, images:[] });
      document.getElementById('topCarouselEnabled').checked = !!carousel.enabled;
      document.getElementById('topCarouselInterval').value = Number(carousel.interval || 8);
      document.getElementById('topCarouselImages').value = (carousel.images||[]).join(', ');

      document.getElementById('saveCarousel').onclick = () => {
        const enabled = document.getElementById('topCarouselEnabled').checked;
        const interval = Number(document.getElementById('topCarouselInterval').value) || 8;
        const images = document.getElementById('topCarouselImages').value.split(',').map(s=>s.trim()).filter(Boolean);
        setJSON('adCarousel', { enabled, interval, images });
        broadcast();
        alert('è½®æ’­è®¾ç½®å·²ä¿å­˜');
        maybeAutoPushAdConfig();
      };
      const vis = getJSON('adVisibility', { top: true, left: true, right: true });
      document.getElementById('topVisible').checked = !!vis.top;
      document.getElementById('leftVisible').checked = !!vis.left;
      document.getElementById('rightVisible').checked = !!vis.right;

      const top = getJSON('adConfig', DEFAULT_AD);
      document.getElementById('topLink').value = top.link || '';
      document.getElementById('topImage').value = top.image || '';
      document.getElementById('topText').value = top.text || '';
      document.getElementById('topTextColor').value = top.textColor || '#ffffff';
      document.getElementById('topTextSize').value = Number(top.textSize || 16);
      document.getElementById('topTextPos').value = top.textPos || 'lb';
      document.getElementById('topBgColor').value = top.bgColor || '#000000';
      document.getElementById('topBgOpacity').value = Number(coalesce(top.bgOpacity, 55));
      document.getElementById('topRadius').value = Number(coalesce(top.radius, 8));
      document.getElementById('topFontFamily').value = top.fontFamily || '';
      document.getElementById('topShadow').value = Number(top.shadowStrength ?? 0.35);
      document.getElementById('topTextAlign').value = top.textAlign || 'left';
      document.getElementById('topOutlineWidth').value = Number(top.outlineWidth || 0);
      document.getElementById('topOutlineColor').value = top.outlineColor || '#000000';
      document.getElementById('topTextBold').checked = !!top.textBold;
      document.getElementById('topTextHtml').checked = !!top.textHtml;

      const left = getJSON('leftAdConfig', DEFAULT_SIDE_AD);
      document.getElementById('leftLink').value = left.link || '';
      document.getElementById('leftImage').value = left.image || '';
      document.getElementById('leftText').value = left.text || '';
      document.getElementById('leftTextColor').value = left.textColor || '#ffffff';
      document.getElementById('leftTextSize').value = Number(left.textSize || 16);
      document.getElementById('leftTextPos').value = left.textPos || 'lb';
      document.getElementById('leftBgColor').value = left.bgColor || '#000000';
      document.getElementById('leftBgOpacity').value = Number(coalesce(left.bgOpacity, 55));
      document.getElementById('leftRadius').value = Number(coalesce(left.radius, 8));
      document.getElementById('leftFontFamily').value = left.fontFamily || '';
      document.getElementById('leftShadow').value = Number(left.shadowStrength ?? 0.35);
      document.getElementById('leftTextAlign').value = left.textAlign || 'left';
      document.getElementById('leftOutlineWidth').value = Number(left.outlineWidth || 0);
      document.getElementById('leftOutlineColor').value = left.outlineColor || '#000000';
      document.getElementById('leftTextBold').checked = !!left.textBold;
      document.getElementById('leftTextHtml').checked = !!left.textHtml;

      const right = getJSON('rightAdConfig', DEFAULT_SIDE_AD);
      document.getElementById('rightLink').value = right.link || '';
      document.getElementById('rightImage').value = right.image || '';
      document.getElementById('rightText').value = right.text || '';
      document.getElementById('rightTextColor').value = right.textColor || '#ffffff';
      document.getElementById('rightTextSize').value = Number(right.textSize || 16);
      document.getElementById('rightTextPos').value = right.textPos || 'lb';
      document.getElementById('rightBgColor').value = right.bgColor || '#000000';
      document.getElementById('rightBgOpacity').value = Number(coalesce(right.bgOpacity, 55));
      document.getElementById('rightRadius').value = Number(coalesce(right.radius, 8));
      document.getElementById('rightFontFamily').value = right.fontFamily || '';
      document.getElementById('rightShadow').value = Number(right.shadowStrength ?? 0.35);
      document.getElementById('rightTextAlign').value = right.textAlign || 'left';
      document.getElementById('rightOutlineWidth').value = Number(right.outlineWidth || 0);
      document.getElementById('rightOutlineColor').value = right.outlineColor || '#000000';
      document.getElementById('rightTextBold').checked = !!right.textBold;
      document.getElementById('rightTextHtml').checked = !!right.textHtml;

      document.getElementById('saveTop').onclick = () => {
        setJSON('adConfig', { link: byId('topLink'), image: byId('topImage'), text: byId('topText'), textColor: byId('topTextColor'), textSize: toNum('topTextSize', 16), textPos: byId('topTextPos'), bgColor: byId('topBgColor'), bgOpacity: toNum('topBgOpacity', 55), radius: toNum('topRadius', 8), fontFamily: byId('topFontFamily'), shadowStrength: toNum('topShadow', 0.35), textAlign: byId('topTextAlign'), outlineWidth: toNum('topOutlineWidth', 0), outlineColor: byId('topOutlineColor'), textBold: document.getElementById('topTextBold').checked, textHtml: document.getElementById('topTextHtml').checked });
        broadcast();
        alert('é¡¶éƒ¨å¹¿å‘Šå·²ä¿å­˜');
        maybeAutoPushAdConfig();
      };
      document.getElementById('resetTop').onclick = () => {
        setJSON('adConfig', DEFAULT_AD);
        alert('é¡¶éƒ¨å¹¿å‘Šå·²æ¢å¤é»˜è®¤');
        maybeAutoPushAdConfig();
      };

      document.getElementById('saveLeft').onclick = () => {
        setJSON('leftAdConfig', { link: byId('leftLink'), image: byId('leftImage'), text: byId('leftText'), textColor: byId('leftTextColor'), textSize: toNum('leftTextSize', 16), textPos: byId('leftTextPos'), bgColor: byId('leftBgColor'), bgOpacity: toNum('leftBgOpacity', 55), radius: toNum('leftRadius', 8), fontFamily: byId('leftFontFamily'), shadowStrength: toNum('leftShadow', 0.35), textAlign: byId('leftTextAlign'), outlineWidth: toNum('leftOutlineWidth', 0), outlineColor: byId('leftOutlineColor'), textBold: document.getElementById('leftTextBold').checked, textHtml: document.getElementById('leftTextHtml').checked });
        broadcast();
        alert('å·¦ä¾§å¹¿å‘Šå·²ä¿å­˜');
        maybeAutoPushAdConfig();
      };
      document.getElementById('resetLeft').onclick = () => {
        setJSON('leftAdConfig', DEFAULT_SIDE_AD);
        alert('å·¦ä¾§å¹¿å‘Šå·²æ¢å¤é»˜è®¤');
        maybeAutoPushAdConfig();
      };

      document.getElementById('saveRight').onclick = () => {
        setJSON('rightAdConfig', { link: byId('rightLink'), image: byId('rightImage'), text: byId('rightText'), textColor: byId('rightTextColor'), textSize: toNum('rightTextSize', 16), textPos: byId('rightTextPos'), bgColor: byId('rightBgColor'), bgOpacity: toNum('rightBgOpacity', 55), radius: toNum('rightRadius', 8), fontFamily: byId('rightFontFamily'), shadowStrength: toNum('rightShadow', 0.35), textAlign: byId('rightTextAlign'), outlineWidth: toNum('rightOutlineWidth', 0), outlineColor: byId('rightOutlineColor'), textBold: document.getElementById('rightTextBold').checked, textHtml: document.getElementById('rightTextHtml').checked });
        broadcast();
        alert('å³ä¾§å¹¿å‘Šå·²ä¿å­˜');
        maybeAutoPushAdConfig();
      };
      document.getElementById('resetRight').onclick = () => {
        setJSON('rightAdConfig', DEFAULT_SIDE_AD);
        alert('å³ä¾§å¹¿å‘Šå·²æ¢å¤é»˜è®¤');
        maybeAutoPushAdConfig();
      };

      document.getElementById('topVisible').onchange = saveVisibility;
      document.getElementById('leftVisible').onchange = saveVisibility;
      document.getElementById('rightVisible').onchange = saveVisibility;
    }

    function saveVisibility() {
      const v = {
        top: document.getElementById('topVisible').checked,
        left: document.getElementById('leftVisible').checked,
        right: document.getElementById('rightVisible').checked,
      };
      setJSON('adVisibility', v);
      broadcast();
      maybeAutoPushAdConfig();
    }

    function byId(id) { return document.getElementById(id).value.trim(); }
    function toNum(id, defVal) { const v = Number(document.getElementById(id).value); return Number.isFinite(v) ? v : defVal; }
    function toNumPrompt(message, defVal) { const v = Number(prompt(message, String(defVal))); return Number.isFinite(v) ? v : defVal; }

    function broadcast(){
      try{ const bc = new BroadcastChannel('ad-config'); bc.postMessage({ type:'refresh' }); }catch(_){ /* ignore */ }
    }
    // ==== ä¸€é”®çˆ¬å–/è‡ªåŠ¨æ›´æ–°ï¼ˆçº¯å‰ç«¯å°è¯•ï¼Œéœ€ç›®æ ‡ç«™å…è®¸CORSæˆ–é…ç½®ä»£ç†ï¼‰====
    let lastCsvContent = '';
    function nowStamp(){
      const d = new Date();
      const p = (n)=> String(n).padStart(2,'0');
      return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}_${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
    }

    function loadCsvHistoryJson(){
      try { return JSON.parse(localStorage.getItem('csvHistoryJson')||'[]'); } catch { return []; }
    }
    function saveCsvHistoryJson(arr){
      try { localStorage.setItem('csvHistoryJson', JSON.stringify(arr)); } catch {}
    }
    function jsonToCsv(arr){
      let csv = 'å½±ç‰‡åç§°,m3u8 é“¾æ¥,å°é¢,ç®€ä»‹\n';
      arr.forEach(o=>{
        const r = [o.title||'', o.url||'', o.cover||'', o.desc||''];
        const line = r.map(v=> '"'+String(v||'').replace(/"/g,'""')+'"').join(',');
        csv += line+'\n';
      });
      return csv;
    }

    // ==== è‡ªåŠ¨åŒæ­¥ï¼ˆæŒä¹…åŒ–è®¾ç½® + æŒ‰éœ€è§¦å‘ï¼‰====
    function loadAutoSync(){
      try { return JSON.parse(localStorage.getItem('autoSync')||'null') || { pushAd:false, pushCsv:false }; } catch { return { pushAd:false, pushCsv:false }; }
    }
    function saveAutoSync(cfg){
      try { localStorage.setItem('autoSync', JSON.stringify(cfg)); } catch {}
    }
    function maybeAutoPushAdConfig(){
      const cfg = loadAutoSync();
      if (!cfg.pushAd) return;
      // éœ€è¦ GitHub å‡­æ®
      const owner = byId('ghOwner');
      const repo = byId('ghRepo');
      const token = byId('ghToken');
      if (!owner || !repo || !token) return;
      try { pushAdConfig(); } catch(_){}
    }
    function maybeAutoPushCsv(){
      const cfg = loadAutoSync();
      if (!cfg.pushCsv) return;
      // éœ€è¦ GitHub å‡­æ®
      const owner = byId('ghOwner');
      const repo = byId('ghRepo');
      const token = byId('ghToken');
      if (!owner || !repo || !token) return;
      try { pushGithub(); } catch(_){}
    }

    // ==== è·¨è®¾å¤‡å¹¿å‘Šé…ç½®åŒæ­¥ ====
    function buildAdConfigObject(){
      return {
        adConfig: getJSON('adConfig', DEFAULT_AD),
        leftAdConfig: getJSON('leftAdConfig', DEFAULT_SIDE_AD),
        rightAdConfig: getJSON('rightAdConfig', DEFAULT_SIDE_AD),
        adVisibility: getJSON('adVisibility', { top:true, left:true, right:true }),
        adCarousel: getJSON('adCarousel', { enabled:false, interval:8, images:[] })
      };
    }

    function downloadAdConfig(){
      const obj = buildAdConfigObject();
      const json = JSON.stringify(obj, null, 2);
      const blob = new Blob([json], {type:'application/json;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'ad_config.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    async function pushAdConfig(){
      const statusEl = document.getElementById('cfgPushStatus');
      function setStatus(msg){ if (statusEl) statusEl.textContent = msg; }
      try{
        const owner = byId('ghOwner');
        const repo = byId('ghRepo');
        const branch = byId('ghBranch') || 'main';
        const token = byId('ghToken');
        const path = byId('cfgPath') || 'ad_config.json';
        if (!owner || !repo || !token){ alert('è¯·å…ˆåœ¨ä¸‹æ–¹å¡«å†™ GitHub Owner/Repo/Token'); return; }
        setStatus('æ¨é€ä¸­...');
        const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        // è·å– sha
        let sha = null;
        try{
          const res = await fetch(apiBase+`?ref=${encodeURIComponent(branch)}`, { headers:{ Authorization:`Bearer ${token}` } });
          if (res.ok){ const j = await res.json(); sha = j.sha; }
        }catch(_){ }
        const content = JSON.stringify(buildAdConfigObject(), null, 2);
        const body = { message: 'chore: update ad_config.json via admin', content: btoa(unescape(encodeURIComponent(content))), branch };
        if (sha) body.sha = sha;
        const put = await fetch(apiBase, { method:'PUT', headers:{ 'Content-Type':'application/json', Authorization:`Bearer ${token}` }, body: JSON.stringify(body) });
        if (!put.ok){ const t = await put.text(); alert('æ¨é€å¤±è´¥: '+t); setStatus('å¤±è´¥'); return; }
        alert('æ¨é€æˆåŠŸ');
        setStatus('å·²æ¨é€');
      }catch(e){ console.error(e); alert('æ¨é€å¤±è´¥ï¼š'+ (e && e.message ? e.message : String(e))); setStatus('å¤±è´¥'); }
    }

    async function fetchRaw(url, proxy) {
      try {
        let target = url;
        if (proxy && proxy.includes('%s')) target = proxy.replace('%s', encodeURIComponent(url));
        else if (proxy) target = proxy + encodeURIComponent(url);
        const res = await fetch(target, { credentials: 'omit' });
        if (!res.ok) throw new Error('HTTP '+res.status);
        return await res.text();
      } catch (e) {
        console.warn('fetchRaw failed', url, e);
        return '';
      }
    }

    function absUrl(base, href){
      if (!href) return '';
      if (/^https?:\/\//i.test(href)) return href;
      if (href.startsWith('/')) {
        try { const u = new URL(base); return `${u.origin}${href}` } catch { return href }
      }
      try { return new URL(href, base).href } catch { return href }
    }

    function extractList(html, base){
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const items = [];
      doc.querySelectorAll('.videoContent li').forEach(li => {
        const a = li.querySelector('a.videoName');
        if (!a) return;
        const title = a.textContent.trim();
        const href = absUrl(base, a.getAttribute('href'));
        let cover = '';
        const img = li.querySelector('img');
        if (img) {
          cover = img.getAttribute('data-original') || img.getAttribute('src') || '';
          cover = absUrl(base, cover);
          if (cover.includes('/template/')) cover = '';
        }
        items.push({ title, href, cover });
      });
      // next page
      let next = '';
      const np = doc.querySelector(".pages a[title='ä¸‹ä¸€é¡µ']");
      if (np && np.getAttribute('href')) next = absUrl(base, np.getAttribute('href'));
      return { items, next };
    }

    function extractDetail(html, base){
      const doc = new DOMParser().parseFromString(html, 'text/html');
      // m3u8 links
      const texts = [doc.body.innerText || '', ...Array.from(doc.querySelectorAll('a.copy_text, .play_list a, a[onclick]')).map(a=> (a.textContent||'')+' '+(a.getAttribute('href')||'')+' '+(a.getAttribute('onclick')||''))];
      const m3u8s = [];
      const rx = /https?:\/\/[^\s'\"]+?\.m3u8/g;
      texts.forEach(t => { (t.match(rx)||[]).forEach(u => m3u8s.push(u)); });
      const m3u8 = Array.from(new Set(m3u8s)).join(' | ');
      // cover
      let cover = '';
      const og = doc.querySelector('meta[property="og:image"]');
      if (og && og.content) cover = absUrl(base, og.content.trim());
      if (!cover) {
        const sels = [
          '.poster img', '.playLeft img', '.playleft img', '.videoCover img',
          '.vodImg img', '.detail-pic img', '.stui-content__thumb img',
          "img[src$='.jpg']", "img[src$='.png']", "img[src$='.webp']"
        ];
        for (const sel of sels) {
          const im = doc.querySelector(sel);
          if (im && im.getAttribute('src')) {
            const u = absUrl(base, im.getAttribute('src').trim());
            if (!u.includes('/template/')) { cover = u; break; }
          }
        }
      }
      // desc
      let desc = '';
      const meta = doc.querySelector('meta[name="description"], meta[property="og:description"]');
      if (meta && meta.content) desc = meta.content.trim();
      if (!desc) {
        const sels = ['.vodContent', '.vod_content', '.videoInfo .desc', '.detail-desc', '.info .content', '.detail .content', '.context .content', '.vodplayinfo', '.playinfo', '.stui-content__detail', '.module-info-introduction-content'];
        for (const sel of sels) {
          const el = doc.querySelector(sel);
          if (el) { const t = el.textContent.trim(); if (t) { desc = t; break; } }
        }
      }
      if (desc.endsWith('æ£®æ—èµ„æº')) desc = desc.replace(/[_-]?æ£®æ—èµ„æº\s*$/,'');
      if (desc.length > 1000) desc = desc.slice(0,1000)+'...';
      return { m3u8, cover, desc };
    }

    async function crawlOnce(){
      const statusEl = document.getElementById('crawlStatus');
      function setStatus(msg){ if (statusEl) statusEl.textContent = msg; }
      try{
        setStatus('å¼€å§‹æŠ“å–...');
        const sites = (document.getElementById('crawlSites').value||'').split(',').map(s=>s.trim()).filter(Boolean);
        if (!sites.length) { alert('è¯·å¡«å†™ç›®æ ‡åˆ—è¡¨é¡µèµ·å§‹URL'); setStatus('æœªå¼€å§‹'); return; }
        const pages = Number(document.getElementById('crawlPages').value)||5;
        const sleep = Math.max(0, Number(document.getElementById('crawlSleep').value)||1.0);
        const proxy = document.getElementById('crawlProxy').value.trim();
        const rows = [];
        for (const startUrl of sites){
          let url = startUrl; let page=1;
          while (url && page<=pages){
            setStatus(`æŠ“å–åˆ—è¡¨ç¬¬ ${page}/${pages} é¡µ...`);
            const html = await fetchRaw(url, proxy);
            if (!html) { console.warn('åˆ—è¡¨é¡µæŠ“å–å¤±è´¥', url); break; }
            const { items, next } = extractList(html, url);
            setStatus(`æœ¬é¡µå…± ${items.length} æ¡ï¼Œæ­£åœ¨æŠ“å–è¯¦æƒ…...`);
            for (let i=0;i<items.length;i++){
              const it = items[i];
              setStatus(`æŠ“å–è¯¦æƒ… ${i+1}/${items.length}`);
              const dhtml = await fetchRaw(it.href, proxy);
              if (!dhtml) { console.warn('è¯¦æƒ…æŠ“å–å¤±è´¥', it.href); continue; }
              const det = extractDetail(dhtml, it.href);
              if (det.m3u8){ rows.push([it.title, det.m3u8, det.cover || it.cover || '', det.desc || '']); }
              await new Promise(r=>setTimeout(r, sleep*1000));
            }
            url = next; page++;
          }
        }
        // to CSV
        let csv = 'å½±ç‰‡åç§°,m3u8 é“¾æ¥,å°é¢,ç®€ä»‹\n';
        rows.forEach(r=>{
          const line = r.map(v=> '"'+String(v||'').replace(/"/g,'""')+'"').join(',');
          csv += line+'\n';
        });
        lastCsvContent = csv;

        // ç´¯ç§¯åˆ°æœ¬åœ°å†å²ï¼ˆå»é‡ï¼šæŒ‰ m3u8 é“¾æ¥ï¼‰
        const history = loadCsvHistoryJson();
        const urlSet = new Set(history.map(x=>x.url||''));
        rows.forEach(r=>{
          const [title, url, cover, desc] = r;
          if (url && !urlSet.has(url)) {
            history.push({ title, url, cover, desc });
            urlSet.add(url);
          }
        });
        saveCsvHistoryJson(history);
        try { localStorage.setItem('csvHistoryCsv', jsonToCsv(history)); } catch {}
        try { localStorage.setItem('csvHistoryUpdatedAt', new Date().toISOString()); } catch {}
        setStatus(`å®Œæˆï¼Œå…± ${rows.length} æ¡`);
        alert(`æŠ“å–å®Œæˆï¼Œå…± ${rows.length} æ¡ã€‚å¯ç‚¹å‡»â€œä¸‹è½½CSVâ€æˆ–é…ç½® GitHub æ¨é€ã€‚`);
        // è‹¥å¼€å¯è‡ªåŠ¨åŒæ­¥ï¼Œè‡ªåŠ¨æ¨é€ CSV
        try { maybeAutoPushCsv(); } catch(_){}
      }catch(err){
        console.error(err);
        alert('æŠ“å–å¤±è´¥ï¼š'+ (err && err.message ? err.message : String(err)));
        const statusEl = document.getElementById('crawlStatus');
        if (statusEl) statusEl.textContent = 'å¤±è´¥';
      }
    }

    function downloadCsv(){
      if (!lastCsvContent){ alert('è¿˜æ²¡æœ‰æŠ“å–ç»“æœ'); return; }
      const blob = new Blob([lastCsvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'video_data_'+ nowStamp() +'.csv';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    async function pushGithub(){
      if (!lastCsvContent){ alert('è¿˜æ²¡æœ‰æŠ“å–ç»“æœ'); return; }
      const owner = byId('ghOwner');
      const repo = byId('ghRepo');
      const branch = byId('ghBranch') || 'main';
      const path = byId('ghPath') || 'video_data.csv';
      const token = byId('ghToken');
      try { localStorage.setItem('ghCreds', JSON.stringify({ owner, repo, branch, path, token })); } catch(_){ }
      if (!owner || !repo || !token){ alert('è¯·å¡«å†™ Owner/Repo/Token'); return; }
      const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      // è·å– sha
      let sha = null;
      try{
        const res = await fetch(apiBase+`?ref=${encodeURIComponent(branch)}`, { headers:{ Authorization:`Bearer ${token}` } });
        if (res.ok){ const j = await res.json(); sha = j.sha; }
      }catch(_){ }
      // æäº¤
      const content = btoa(unescape(encodeURIComponent(lastCsvContent)));
      const body = { message: 'chore: update video_data.csv via admin', content, branch };
      if (sha) body.sha = sha;
      const put = await fetch(apiBase, { method:'PUT', headers:{ 'Content-Type':'application/json', Authorization:`Bearer ${token}` }, body: JSON.stringify(body) });
      if (!put.ok){ const t = await put.text(); alert('æ¨é€å¤±è´¥: '+t); return; }
      alert('æ¨é€æˆåŠŸ');
      broadcast();
    }

    // å®šæ—¶ä»»åŠ¡ï¼ˆé¡µé¢æ‰“å¼€æœŸé—´ç”Ÿæ•ˆï¼‰
    let autoTimer = null;
    function loadAuto(){
      try{ return JSON.parse(localStorage.getItem('crawlSchedule')||'null')||{ enabled:false, intervalMin:60 } }catch{ return { enabled:false, intervalMin:60 } }
    }
    function saveAuto(cfg){ localStorage.setItem('crawlSchedule', JSON.stringify(cfg)); }
    function applyAuto(){
      const cfg = loadAuto();
      document.getElementById('autoEnabled').checked = !!cfg.enabled;
      document.getElementById('autoInterval').value = Number(cfg.intervalMin||60);
      const st = document.getElementById('autoStatus');
      if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      if (cfg.enabled){
        autoTimer = setInterval(async ()=>{ await crawlOnce(); /* å¯é€‰è‡ªåŠ¨æ¨é€ */ }, Math.max(1, cfg.intervalMin||60)*60*1000);
        st.textContent = `å·²å¼€å¯ï¼Œæ¯ ${cfg.intervalMin} åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆéœ€ä¿æŒæœ¬é¡µæ‰“å¼€ï¼‰`;
      } else {
        st.textContent = 'æœªå¼€å¯';
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      requireAuth();
      init();
      // é¢„å¡«ï¼šç›®æ ‡ç«™ä¸ä»£ç†ï¼ˆå¯ä¿®æ”¹ï¼‰
      const cs = document.getElementById('crawlSites');
      if (!cs.value.trim()) cs.value = DEFAULT_START_URL;
      const cp = document.getElementById('crawlProxy');
      if (!cp.value.trim()) cp.value = DEFAULT_CORS_PROXY;
      // ç»‘å®šçˆ¬å–æŒ‰é’®
      document.getElementById('btnCrawlNow').onclick = crawlOnce;
      document.getElementById('btnDownloadCsv').onclick = downloadCsv;
      document.getElementById('btnPushGithub').onclick = pushGithub;
      document.getElementById('btnSaveAuto').onclick = ()=>{ const cfg = { enabled: document.getElementById('autoEnabled').checked, intervalMin: Number(document.getElementById('autoInterval').value)||60 }; saveAuto(cfg); applyAuto(); maybeAutoPushAdConfig(); };
      applyAuto();

      // é¢„å¡« GitHub è·¯å¾„ä¸ºå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶åï¼ˆè‹¥ä¸ºç©ºæˆ–é»˜è®¤å€¼ï¼‰
      try{
        const ghp = document.getElementById('ghPath');
        if (ghp && (!ghp.value || ghp.value === 'video_data.csv')) ghp.value = 'video_data_'+ nowStamp() +'.csv';
      }catch(_){ }

      // è·¨è®¾å¤‡é…ç½®åŒæ­¥æŒ‰é’®ç»‘å®š
      try{
        document.getElementById('btnDownloadConfig').onclick = downloadAdConfig;
        document.getElementById('btnPushConfig').onclick = pushAdConfig;
        const cfgp = document.getElementById('cfgPath');
        if (cfgp && (!cfgp.value || cfgp.value === 'ad_config.json')) cfgp.value = 'ad_config.json';
      }catch(_){ }

      // è‡ªåŠ¨åŒæ­¥è®¾ç½®ç»‘å®š
      try{
        const sync = loadAutoSync();
        const cbAd = document.getElementById('autoSyncAd');
        const cbCsv = document.getElementById('autoSyncCsv');
        if (cbAd) cbAd.checked = !!sync.pushAd;
        if (cbCsv) cbCsv.checked = !!sync.pushCsv;
        document.getElementById('btnSaveSync').onclick = () => {
          const cfg = { pushAd: !!document.getElementById('autoSyncAd').checked, pushCsv: !!document.getElementById('autoSyncCsv').checked };
          saveAutoSync(cfg);
          const st = document.getElementById('syncStatus');
          if (st) st.textContent = 'å·²ä¿å­˜';
        };
      }catch(_){ }
    });
  </script>
</body>
</html>
